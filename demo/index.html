<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        background: #fafafa;
      }
    </style>
  </head>
  <body>
    <div id="demo">
      <h2>Catalog</h2>
      <p>Product 1000 <button id="p1000">+</button><button id="m1000">-</button></p>
      <p>Product 2000 <button id="p2000">+</button><button id="m2000">-</button></p>
      <h2>Cart</h2>
      <div id="cart"></div>
    </div>

    <script type="module">
      import { Cart } from '../dist/src/cart.js';
      import { CartTransaction } from '../dist/src/cartTransaction.js';
      import { WebStorageCartStorage } from '../dist/src/webStorageCartStorage.js';

      class DemoObserver {
        onCartUpdated(cart) {
          const cartData = cart.getData();
          document.getElementById("cart").innerHTML = `
            <p>
               pending transactions: ${cartData.hasPendingTransactions}
               |
               sync error: ${cartData.syncError}
            </p>
            <ul>
              ${cartData.lines.map(line => `<li>product: ${line.productId}, quantity: ${line.quantity}`)}
            </ul>
          `;
        }
      }

      const observer = new DemoObserver();

      const cart = new Cart(null, new WebStorageCartStorage(window.localStorage));
      cart.registerObserver(observer);
      observer.onCartUpdated(cart);

      document.getElementById("p1000").addEventListener("click", () => cart.addTransaction(new CartTransaction(1000, 1)));
      document.getElementById("m1000").addEventListener("click", () => cart.addTransaction(new CartTransaction(1000, -1)));
      document.getElementById("p2000").addEventListener("click", () => cart.addTransaction(new CartTransaction(2000, 1)));
      document.getElementById("m2000").addEventListener("click", () => cart.addTransaction(new CartTransaction(2000, -1)));
    </script>
  </body>
</html>
